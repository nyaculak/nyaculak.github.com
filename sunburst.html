<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Sunburst</title>
</head>
<body>
  <style>
    path:hover {
      opacity: .5;
    }
  </style>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script>
    var CHILD_PRED = "http://purl.org/gem/qualifiers/hasChild";
    var HIDDEN_CHILD_PRED = "_http://purl.org/gem/qualifiers/hasChild";
    var DESCR_PRED = "http://purl.org/dc/terms/description";
    var ROOT_NAME = "http://asn.jesandco.org/resources/D10003FB";
    var data,
        i = 0,
        width  = 600,
        height = 600,
        radius = Math.min(width, height) / 2,
        color  = d3.scale.category10();

    var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height + 25)
      .attr("display", "inline-block");

    var text = svg.append("g")
      .attr("transform", "translate(0, 20)")
      .append("text")
      .attr("id", "text");

    svg = svg.append("g")
      .attr("transform", "translate(" + (width / 2) + "," + (height / 2 + 25) + ")");

    var partition = d3.layout.partition()
      .sort(null)
      .value(function (d) {return 1})
      .size([2 * Math.PI, radius * radius])
      .children(children);

    var arc = d3.svg.arc()
      .startAngle(function(d) { return d.x; })
      .endAngle(function(d) { return d.x + d.dx; })
      .innerRadius(function(d) { return Math.sqrt(d.y); })
      .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

    function children(d) {
      var children = [];
      if (d[CHILD_PRED])
        d[CHILD_PRED].forEach(function (d){children.push(data[d.value]);});
      return children;
    }

    function mouseover(d) {
      if (d.depth != null) text.text(d[DESCR_PRED][0].value);
    }

    function click(d) {
      console.log("click: " + d[DESCR_PRED][0].value);
      var buf = d[HIDDEN_CHILD_PRED];
      d[HIDDEN_CHILD_PRED] = d[CHILD_PRED];
      d[CHILD_PRED] = buf;
      render(null, data);
    }

    function render() {
      // compute layout
      var nodes = partition.nodes(data[ROOT_NAME]);

      var paths = svg.selectAll("path").data(nodes, function(d) { return d.id || (d.id = ++i); });
      paths.enter()
        .append("path")
        .attr("d", arc)
        .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
        .style("fill", function(d) { return color(d.id); })
        .style("stroke", "#fff")
        .on('mouseover', function(d) { if (d.depth != null) text.text(d[DESCR_PRED][0].value); })
        .on('mouseout',  function(d) { text.text("");})
        .on('click', click);

        paths.attr("d", arc);
        paths.exit().remove();
    }
    d3.json("/data/s1.json", function(error, json) {
      if(error) throw error;
      data = json;
      function minimize(d) {
        children(d).forEach(minimize);
        d[HIDDEN_CHILD_PRED] = d[CHILD_PRED];
        d[CHILD_PRED] = null;
      }
      children(data[ROOT_NAME]).forEach(minimize);
      render();
    });

  </script>
</body>
</html>
