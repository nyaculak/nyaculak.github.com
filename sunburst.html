<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Sunburst</title>
</head>
<body>
  <style>
    body {
      text-align:center;
    }
    path:hover {
      opacity: .5;
    }
  </style>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script>
    var CHILD_PRED = "http://purl.org/gem/qualifiers/hasChild";
    var HIDDEN_CHILD_PRED = "_http://purl.org/gem/qualifiers/hasChild";
    var DESCR_PRED = "http://purl.org/dc/terms/description";
    var ROOT_NAME = "http://asn.jesandco.org/resources/D10003FB";
    var ROOT_NAME_T1 = "http://asn.jesandco.org/resources/D10003B9";
    var ROOT_NAME_T2 = "http://asn.jesandco.org/resources/D100029D";
    var data, data_t1, data_t2,
        i = 0,
        width  = 400, // 600
        height = 400,
        radius = Math.min(width, height) / 2,
        color  = d3.scale.category10();

    var svg = d3.select("body").append("svg")
      .attr("width", width * 3 + 20 + 20)
      .attr("height", 600)
      .attr("margin", "0 auto");

    var text = svg.append("g")
      .attr("transform", "translate(0, 20)")
      .append("text")
      .attr("id", "text");

    var mastersvg = svg;

    svg = svg.append("g")
      .attr("transform", "translate(" + (width / 2 + 10) + "," + (height / 2 + 25) + ")");

    var svg2 = mastersvg.append("g")
      .attr("transform", "translate(" + (3 * width / 2 + 20) + "," + (height / 2 + 25) + ")");

    var svg3 = mastersvg.append("g")
      .attr("transform", "translate(" + (5 * width / 2 + 30) + "," + (height / 2 + 25) + ")");

    var partition = d3.layout.partition()
      .sort(null)
      .value(function (d) {return 1})
      .size([2 * Math.PI, radius * radius])
      .children(children);

    var partition_t1 = d3.layout.partition()
      .sort(null)
      .value(function (d) {return 1})
      .size([2 * Math.PI, radius * radius])
      .children(children_t1);

    var partition_t2 = d3.layout.partition()
      .sort(null)
      .value(function (d) {return 1})
      .size([2 * Math.PI, radius * radius])
      .children(children_t2);

    var arc = d3.svg.arc()
      .startAngle(function(d) { return d.x; })
      .endAngle(function(d) { return d.x + d.dx; })
      .innerRadius(function(d) { return Math.sqrt(d.y); })
      .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

    function children(d) {
      var children = [];
      if (d[CHILD_PRED])
        d[CHILD_PRED].forEach(function (d){children.push(data[d.value]);});
      return children;
    }

    function children_t1(d) {
      var children = [];
      if (d[CHILD_PRED])
        d[CHILD_PRED].forEach(function (d){children.push(data_t1[d.value]);});
      return children;
    }

    function children_t2(d) {
      var children = [];
      if (d[CHILD_PRED])
        d[CHILD_PRED].forEach(function (d){children.push(data_t2[d.value]);});
      return children;
    }

    function mouseover(d) {
      if (d.depth != null) text.text(d[DESCR_PRED][0].value);
    }

    function click(d) {
      console.log("click: " + d[DESCR_PRED][0].value);
      var buf = d[HIDDEN_CHILD_PRED];
      d[HIDDEN_CHILD_PRED] = d[CHILD_PRED];
      d[CHILD_PRED] = buf;
      render(null, data);
    }

    function render() {
      // compute layout
      var nodes, paths;

      nodes = partition_t1.nodes(data_t1[ROOT_NAME_T1]);
      paths = svg.selectAll("path").data(nodes, function(d) { return d.id || (d.id = ++i); });
      paths.enter()
        .append("path")
        .attr("d", arc)
        .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
        .style("fill", function(d) { return color(d.id); })
        .style("stroke", "#fff")
        .on('mouseover', function(d) { if (d.depth != null) text.text(d[DESCR_PRED][0].value); })
        .on('mouseout',  function(d) { text.text("");})
        .on('click', click);
      paths.attr("d", arc);
      paths.exit().remove();

      nodes = partition.nodes(data[ROOT_NAME]);
      paths = svg2.selectAll("path").data(nodes, function(d) { return d.id || (d.id = ++i); });
      paths.enter()
        .append("path")
        .attr("d", arc)
        .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
        .style("fill", function(d) { return color(d.id); })
        .style("stroke", "#fff")
        .on('mouseover', function(d) { if (d.depth != null) text.text(d[DESCR_PRED][0].value); })
        .on('mouseout',  function(d) { text.text("");})
        .on('click', click);
      paths.attr("d", arc);
      paths.exit().remove();

      nodes = partition_t2.nodes(data_t2[ROOT_NAME_T2]);
      paths = svg3.selectAll("path").data(nodes, function(d) { return d.id || (d.id = ++i); });
      paths.enter()
        .append("path")
        .attr("d", arc)
        .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
        .style("fill", function(d) { return color(d.id); })
        .style("stroke", "#fff")
        .on('mouseover', function(d) { if (d.depth != null) text.text(d[DESCR_PRED][0].value); })
        .on('mouseout',  function(d) { text.text("");})
        .on('click', click);
      paths.attr("d", arc);
      paths.exit().remove();
    }
    d3.json("/data/s1.json", function(error, json) {
      d3.json("/data/t1.json", function(error2, json2) {
        d3.json("/data/t2.json", function(error3, json3) {
          if(error || error2 || error3) throw error;
          data = json;
          data_t1 = json2;
          data_t2 = json3;
          render();
        });
      });
    });

  </script>
</body>
</html>
